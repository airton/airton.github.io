---
import Layout from "@/layouts/Layout.astro";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardFooter, CardTitle } from "@/components/ui/card";
import { IconArrowRight } from "@tabler/icons-react";
import { dateFormat } from "@/helpers/dateFormat";
import ZeroDowntimeCTA from "@/components/ZeroDowntimeCTA.astro";

const postsRaw = await Astro.glob("./posts/*.{md,mdx}");
const posts = postsRaw.map((post: any) => {
  const frontmatter =
    post.frontmatter && Object.keys(post.frontmatter).length > 0
      ? post.frontmatter
      : post.article || {};
  return {
    ...post,
    frontmatter,
  };
});

const articlesSlugs = [
  "10-dicas-tempo-de-inatividade-zero",
  "modificando-a-consulta-usando-pre-get-posts",
  "angularjs-validacao-de-formulario",
];

const articlesFeatured = {
  one: posts.find((post) => post.file.includes(articlesSlugs[0])),
  two: posts.find((post) => post.file.includes(articlesSlugs[1])),
  three: posts.find((post) => post.file.includes(articlesSlugs[2])),
};

const lastArticles = posts.filter(
  (post) => !articlesSlugs.some((slug) => post.file.includes(slug))
);
---

<Layout>
  <section
    class="w-full py-12 md:py-24 lg:py-32 bg-muted/50 dark:bg-muted/80 flex justify-center flex-wrap gap-6"
  >
    <div class="container px-4 md:px-6">
      <h2
        class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl mb-8 text-center"
      >
        Blog
      </h2>

      {
        articlesFeatured.one && (
          <div class="grid gap-6 lg:grid-cols-3">
            <Card className="lg:col-span-2 border-foreground">
              <CardContent className="p-6">
                <div class="space-y-4">
                  <div class="relative aspect-video">
                    <img
                      src={articlesFeatured.one.frontmatter.image}
                      alt={articlesFeatured.one.frontmatter.title}
                      class="rounded-lg object-cover w-full"
                    />
                  </div>
                  <CardTitle className="text-2xl font-bold">
                    {articlesFeatured.one.frontmatter.title}
                  </CardTitle>
                  <p class="text-muted-foreground">
                    {articlesFeatured.one.frontmatter.description}
                  </p>
                  <CardFooter className="px-0">
                    <div class="flex justify-between items-center w-full">
                      <span class="text-sm text-muted-foreground">
                        {dateFormat(articlesFeatured.one.frontmatter.date)}
                      </span>
                      <a href={articlesFeatured.one.url}>
                        <Button variant="default">
                          Veja mais
                          <IconArrowRight className="ml-2 h-4 w-4" />
                        </Button>
                      </a>
                    </div>
                  </CardFooter>
                </div>
              </CardContent>
            </Card>

            <div class="space-y-6">
              {[articlesFeatured.two, articlesFeatured.three].map(
                (post) =>
                  post && (
                    <Card key={post.url} className="border-foreground">
                      <CardContent className="p-4">
                        <div class="space-y-2">
                          <div class="relative aspect-video">
                            <img
                              src={post.frontmatter.image}
                              alt={post.frontmatter.title}
                              class="rounded-lg object-cover w-full"
                            />
                          </div>
                          <CardTitle className="text-xl font-bold">
                            {post.frontmatter.title}
                          </CardTitle>
                          <p class="text-sm text-muted-foreground">
                            {post.frontmatter.excerpt}
                          </p>
                          <div class="flex justify-between items-center">
                            <span class="text-xs text-muted-foreground">
                              {dateFormat(post.frontmatter.date)}
                            </span>
                            <a href={post.url}>
                              <Button variant="ghost">
                                veja mais
                                <IconArrowRight className="ml-1 h-3 w-3" />
                              </Button>
                            </a>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  )
              )}
            </div>
          </div>
        )
      }

      <div class="grid gap-6 mt-6">
        {
          lastArticles.map((post) => (
            <Card key={post.url} className="lg:col-span-2 border-foreground">
              <CardContent className="p-6">
                <div class="space-y-4">
                  <CardTitle className="text-2xl font-bold">
                    {post.frontmatter.title}
                  </CardTitle>
                  <p class="text-muted-foreground">
                    {post.frontmatter.excerpt}
                  </p>
                  <CardFooter className="px-0">
                    <div class="flex justify-between items-center w-full">
                      <span class="text-sm text-muted-foreground">
                        {dateFormat(post.frontmatter.date)}
                      </span>
                      <a href={post.url}>
                        <Button variant="ghost">
                          veja mais
                          <IconArrowRight className="ml-1 h-3 w-3" />
                        </Button>
                      </a>
                    </div>
                  </CardFooter>
                </div>
              </CardContent>
            </Card>
          ))
        }
      </div>
    </div>
    <ZeroDowntimeCTA />
  </section>
</Layout>
